#!/bin/bash

set -euo pipefail

# --- 1. Визначаємо, де лежить цей скрипт ---
SOURCE="${BASH_SOURCE[0]}"
while [ -L "$SOURCE" ]; do
  DIR="$( cd -P "$( dirname "$SOURCE" )" >/dev/null 2>&1 && pwd )"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$( cd -P "$( dirname "$SOURCE" )" >/dev/null 2>&1 && pwd )"

# --- 2. Налаштування шляхів ---

# ВАЖЛИВО: Оскільки скрипт лежить у папці 'scripts', 
# нам треба піднятися на один рівень вгору, щоб знайти корінь проекту.
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

PYTHON_EXEC="$PROJECT_ROOT/.venv/bin/python"
MAIN_SCRIPT="$PROJECT_ROOT/main.py"

# --- 3. Перевірки ---
if [ ! -x "$PYTHON_EXEC" ]; then
    echo "❌ Помилка: Python не знайдено за адресою:"
    echo "   $PYTHON_EXEC"
    echo "   (Скрипт шукав папку .venv в $PROJECT_ROOT)"
    exit 1
fi

if [ ! -f "$MAIN_SCRIPT" ]; then
    echo "❌ Помилка: Не знайдено $MAIN_SCRIPT"
    exit 1
fi

# --- 4. Запуск ---
exec "$PYTHON_EXEC" "$MAIN_SCRIPT" "$@"
